#!/bin/bash

PIDS=`ps -ef | grep -v grep | grep -- "globus-gridftp-server" \
     | awk '{ printf "%s ", $2; }'`
echo $PIDS
if [[ "$PIDS" != "" ]]; then
    kill -9 $PIDS
fi

. /etc/esg.env
export X509_CERT_DIR=/etc/grid-security/certificates
export GLOBUS_TCP_PORT_RANGE=50000,51000
export GLOBUS_TCP_SOURCE_RANGE=50000,51000
export GSI_AUTHZ_CONF=/etc/grid-security/gsi-authz.conf
export GLOBUS_USAGE_DEBUG=MESSAGES,/esg/log/esg-server-usage-gridftp.log

# export GLOBUS_GSI_AUTHZ_DEBUG_LEVEL=2
# export GLOBUS_GSI_AUTHZ_DEBUG_FILE=/tmp/GFTPAUTHLOG
export JAVA_HOME=/usr/local/java

CMD="/usr/local/globus/sbin/globus-gridftp-server \
    -no-cas"

# uncomment the line below for extra logging in /var/log/gridftp-esg
CMD="$CMD -d ALL -l /var/log/gridftp-esg"

at now << DONE1
$CMD -p 2811
DONE1

at now << DONE2
$CMD -p 2812
DONE2
